(function(){var e={5340:function(){},5788:function(e,t,s){"use strict";var i=s(5130),a=s(6768),n=s(4232);const o={id:"p2p-app"},r={class:"main-container"},c={class:"app-header"},l={class:"status-indicator"},d={class:"status-text"},h={class:"content-layout"},u={class:"video-panel"},p={class:"video-stage"},m={class:"remote-view"},v={ref:"remoteVideo",autoplay:"",playsinline:"",class:"remote-video-el"},k={key:0,class:"video-placeholder"},f={key:1,class:"video-placeholder waiting"},g={key:2,class:"overlay-btn-wrapper"},b={class:"local-view"},y={ref:"localVideo",autoplay:"",playsinline:"",muted:"",class:"local-video-el"},w={key:0,class:"local-placeholder"},C={key:0,class:"controls-bar"},L={class:"icon-mic"},E={class:"icon-cam"},I={key:0,class:"login-overlay"},x={class:"login-box"},T={class:"ipv6-status-box"},S={key:0,class:"checking"},M={key:1,class:"success"},P={key:2,class:"error"},O=["disabled"],_={class:"chat-panel"},A={class:"chat-header"},R={key:0,class:"room-tag"},j={class:"chat-messages",ref:"chatBox"},V={key:0,class:"empty-chat"},X={class:"msg-bubble"},B={class:"chat-input-area"},$=["disabled"],J=["disabled"];function Q(e,t,s,Q,W,N){return(0,a.uX)(),(0,a.CE)("div",o,[t[21]||(t[21]=(0,a.Lk)("div",{class:"bg-gradient"},null,-1)),(0,a.Lk)("div",r,[(0,a.Lk)("header",c,[t[12]||(t[12]=(0,a.Lk)("div",{class:"logo"},[(0,a.Lk)("span",{class:"icon"},"ðŸ”’"),(0,a.eW)(" Encrypted Link ")],-1)),(0,a.Lk)("div",l,[(0,a.Lk)("span",{class:(0,n.C4)(["ipv6-tag",{ready:W.ipv6Ready}])},(0,n.v_)(W.ipv6Ready?"IPv6 On":"IPv6 Off"),3),t[11]||(t[11]=(0,a.Lk)("div",{class:"divider"},null,-1)),(0,a.Lk)("span",{class:(0,n.C4)(["status-dot",W.status])},null,2),(0,a.Lk)("span",d,(0,n.v_)(N.statusText),1)])]),(0,a.Lk)("div",h,[(0,a.Lk)("div",u,[(0,a.Lk)("div",p,[(0,a.Lk)("div",m,[(0,a.Lk)("video",v,null,512),"connected"!==W.status||W.remoteCameraActive?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",k,[...t[13]||(t[13]=[(0,a.Lk)("div",{class:"placeholder-icon"},"ðŸ“·",-1),(0,a.Lk)("p",null,"å¯¹æ–¹æ‘„åƒå¤´å·²å…³é—­",-1)])])),"connected"!==W.status&&"idle"!==W.status?((0,a.uX)(),(0,a.CE)("div",f,[t[14]||(t[14]=(0,a.Lk)("div",{class:"pulse-ring"},null,-1)),(0,a.Lk)("p",null,(0,n.v_)(N.statusText),1),"queuing"===W.status?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t[0]||(t[0]=(...e)=>N.stopMatch&&N.stopMatch(...e)),class:"cancel-match-btn"}," å–æ¶ˆåŒ¹é… ")):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),W.showPlayBtn?((0,a.uX)(),(0,a.CE)("div",g,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>N.forcePlay&&N.forcePlay(...e)),class:"glass-btn"},[...t[15]||(t[15]=[(0,a.Lk)("span",null,"ðŸ”‡ ç‚¹å‡»å¯ç”¨éŸ³é¢‘",-1)])])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",b,[(0,a.bo)((0,a.Lk)("video",y,null,512),[[i.aG,W.cameraEnabled]]),W.cameraEnabled?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",w,[...t[16]||(t[16]=[(0,a.Lk)("span",{class:"icon-off"},"ðŸ“·",-1),(0,a.Lk)("span",null,"æ‘„åƒå¤´æœªå¼€å¯",-1)])]))]),"connected"===W.status?((0,a.uX)(),(0,a.CE)("div",C,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>N.toggleAudio&&N.toggleAudio(...e)),class:(0,n.C4)(["ctrl-btn",!W.audioEnabled&&"off"]),title:"éº¦å…‹é£Ž"},[(0,a.Lk)("i",L,(0,n.v_)(W.audioEnabled?"ðŸŽ™ï¸":"ðŸ”‡"),1)],2),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>N.stopMatch&&N.stopMatch(...e)),class:"ctrl-btn danger",title:"æŒ‚æ–­"},[...t[17]||(t[17]=[(0,a.Lk)("i",{class:"icon-phone"},"ðŸ“ž",-1)])]),(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>N.toggleCamera&&N.toggleCamera(...e)),class:(0,n.C4)(["ctrl-btn",!W.cameraEnabled&&"off"]),title:"æ‘„åƒå¤´"},[(0,a.Lk)("i",E,(0,n.v_)(W.cameraEnabled?"ðŸ“¹":"ðŸ“·"),1)],2)])):(0,a.Q3)("",!0)]),"idle"===W.status?((0,a.uX)(),(0,a.CE)("div",I,[(0,a.Lk)("div",x,[t[18]||(t[18]=(0,a.Lk)("h3",null,"åŠ å…¥ä¼šè®®",-1)),(0,a.Lk)("div",T,[W.ipv6Checking?((0,a.uX)(),(0,a.CE)("span",S,"ðŸ”„ æ­£åœ¨æ£€æµ‹ç½‘ç»œçŽ¯å¢ƒ...")):W.ipv6Ready?((0,a.uX)(),(0,a.CE)("span",M,"âœ… IPv6 çŽ¯å¢ƒå°±ç»ª ("+(0,n.v_)(W.clientIp)+")",1)):((0,a.uX)(),(0,a.CE)("span",P,"âš ï¸ æœªæ£€æµ‹åˆ° IPv6ï¼Œè¿žæŽ¥å¯èƒ½ä¼šå¤±è´¥"))]),(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>W.roomId=e),placeholder:"è¯·è¾“å…¥æˆ¿é—´å·",class:"room-input",onKeyup:t[6]||(t[6]=(0,i.jR)((...e)=>N.startMatch&&N.startMatch(...e),["enter"]))},null,544),[[i.Jo,W.roomId]]),(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>N.startMatch&&N.startMatch(...e)),disabled:!W.isMediaReady||W.ipv6Checking,class:"join-btn"},(0,n.v_)(N.getJoinButtonText),9,O),t[19]||(t[19]=(0,a.Lk)("p",{class:"hint"},"é»˜è®¤æ‘„åƒå¤´å…³é—­ï¼Œè¿žæŽ¥åŽå¯æ‰‹åŠ¨å¼€å¯",-1))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",_,[(0,a.Lk)("div",A,[t[20]||(t[20]=(0,a.Lk)("span",null,"æ¶ˆæ¯è®°å½•",-1)),W.currentRoom?((0,a.uX)(),(0,a.CE)("span",R,"ID: "+(0,n.v_)(W.currentRoom),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",j,[0===W.messages.length?((0,a.uX)(),(0,a.CE)("div",V,"æš‚æ— æ¶ˆæ¯")):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(W.messages,(e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:(0,n.C4)(["msg-row",e.self?"msg-self":"msg-peer"])},[(0,a.Lk)("div",X,(0,n.v_)(e.text),1)],2))),128))],512),(0,a.Lk)("div",B,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>W.inputText=e),onKeyup:t[9]||(t[9]=(0,i.jR)((...e)=>N.sendChat&&N.sendChat(...e),["enter"])),placeholder:"å‘é€æ¶ˆæ¯...",disabled:"connected"!==W.status},null,40,$),[[i.Jo,W.inputText]]),(0,a.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>N.sendChat&&N.sendChat(...e)),disabled:"connected"!==W.status||!W.inputText.trim()}," âž¤ ",8,J)])])])])])}s(4114),s(3110),s(8335);var W=s(2039),N=s.n(W);"undefined"!==typeof window&&(window.global=window,window.process||(window.process={env:{DEBUG:void 0},nextTick:e=>setTimeout(e,0)}));var U={name:"ModernVideoChat",data(){const e=window.APP_CONFIG||{};return{serverIp:e.serverIp||"2607:8700:5500:63c9::2",wsPort:e.wsPort||38080,useSecure:!1!==e.useSecure,isAdmin:!1,peerIsAdmin:!1,status:"idle",roomId:"",currentRoom:"",ipv6Checking:!0,ipv6Ready:!1,clientIp:"",isMediaReady:!1,showPlayBtn:!1,localStream:null,cameraEnabled:!1,audioEnabled:!0,remoteCameraActive:!0,ws:null,peer:null,inputText:"",messages:[]}},computed:{wsUrl(){const e=this.serverIp.trim(),t=this.useSecure?"wss":"ws";return e.includes(":")&&!e.startsWith("[")?`${t}://[${e}]:${this.wsPort}/ws`:`${t}://${e}:${this.wsPort}/ws`},statusText(){const e={idle:"å°±ç»ª",queuing:"æ­£åœ¨åŒ¹é…ä¸­...",connecting:"å»ºç«‹åŠ å¯†è¿žæŽ¥...",connected:"é€šè¯ä¸­",error:"è¿žæŽ¥æ–­å¼€"};return e[this.status]||this.status},getJoinButtonText(){return this.isMediaReady?this.ipv6Checking?"ç½‘ç»œæ£€æµ‹ä¸­...":"åŠ å…¥å¹¶ç­‰å¾…è¿žæŽ¥":"è®¾å¤‡åˆå§‹åŒ–ä¸­..."}},mounted(){this.initMedia(),this.checkIpv6()},methods:{async checkIpv6(){this.ipv6Checking=!0;try{const e=new AbortController,t=setTimeout(()=>e.abort(),5e3),s=await fetch("https://api6.ipify.org?format=json",{signal:e.signal});clearTimeout(t);const i=await s.json();this.clientIp=i.ip,this.ipv6Ready=this.clientIp.includes(":")}catch(e){console.warn("IPv6 Check Failed:",e),this.ipv6Ready=!1,this.clientIp="æ£€æµ‹å¤±è´¥"}finally{this.ipv6Checking=!1}},async initMedia(){try{this.localStream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:!0});const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!1),this.$refs.localVideo.srcObject=this.localStream,this.isMediaReady=!0}catch(e){console.error("Camera access failed",e),alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æƒé™ã€‚")}},startMatch(){if(this.isMediaReady&&this.roomId){this.isAdmin=this.roomId.startsWith("root_"),this.status="queuing";try{this.ws=new WebSocket(this.wsUrl)}catch(e){return alert("WebSocket åˆ›å»ºå¤±è´¥: "+e.message),void(this.status="idle")}this.ws.onopen=()=>{console.log("WS Connected, joining queue..."),this.ws.send(JSON.stringify({type:"join_queue",roomId:this.roomId.trim()}))},this.ws.onclose=()=>{"idle"!==this.status&&(console.log("WS Closed unexpectedly"),this.stopMatch())},this.ws.onerror=e=>{console.error("WS Error:",e),alert("è¿žæŽ¥æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ IPv6 ç½‘ç»œ"),this.stopMatch()},this.ws.onmessage=e=>{const t=JSON.parse(e.data);switch(t.type){case"matched":if(this.currentRoom=t.room,this.peerIsAdmin=t.peerIsAdmin,!this.isAdmin&&this.peerIsAdmin){const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!0)}this.createPeer(t.initiator);break;case"signal":this.peer&&this.peer.signal(t.payload);break;case"peer_left":this.messages.push({text:"å¯¹æ–¹å·²ç¦»å¼€",self:!1}),this.stopMatch();break}}}},createPeer(e){this.status="connecting";try{this.peer=new(N())({initiator:e,stream:this.localStream,trickle:!0,config:{iceServers:[]}})}catch(t){return console.error("Peer creation failed",t),void this.stopMatch()}this.peer.on("signal",e=>{this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"signal",payload:e}))}),this.peer.on("connect",()=>{if(this.status="connected",console.log("P2P Connection established."),!this.isAdmin&&this.peerIsAdmin){const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!0,console.log("Stealth Mode: Video auto-started for admin."))}}),this.peer.on("stream",e=>{this.$refs.remoteVideo&&(this.$refs.remoteVideo.srcObject=e)}),this.peer.on("close",()=>{this.stopMatch()}),this.peer.on("error",e=>{console.error("Peer error:",e),this.stopMatch()}),this.peer.on("data",e=>{const t=JSON.parse(e.toString());"text"===t.type?(this.messages.push({text:t.content,self:!1}),this.scrollToBottom()):"control"===t.type&&("camera"===t.action?this.remoteCameraActive=t.value:"camera_fake_off"===t.action&&(this.remoteCameraActive=!0))})},toggleCamera(){const e=this.localStream.getVideoTracks()[0];e&&(this.cameraEnabled=!this.cameraEnabled,this.cameraEnabled||this.isAdmin||!this.peerIsAdmin?(e.enabled=this.cameraEnabled,this.sendControl("camera",this.cameraEnabled)):(e.enabled=!0,this.sendControl("camera_fake_off",!1)))},toggleAudio(){const e=this.localStream.getAudioTracks()[0];e&&(this.audioEnabled=!this.audioEnabled,e.enabled=this.audioEnabled)},sendChat(){this.inputText.trim()&&this.peer?.connected&&(this.peer.send(JSON.stringify({type:"text",content:this.inputText})),this.messages.push({text:this.inputText,self:!0}),this.inputText="",this.scrollToBottom())},sendControl(e,t){this.peer?.connected&&this.peer.send(JSON.stringify({type:"control",action:e,value:t}))},stopMatch(){this.peer&&(this.peer.destroy(),this.peer=null),this.ws&&(this.ws.onclose=null,this.ws.onerror=null,this.ws.onmessage=null,this.ws.close(),this.ws=null),this.status="idle",this.messages=[],this.currentRoom="",this.cameraEnabled=!1;const e=this.localStream?.getVideoTracks()[0];e&&(e.enabled=!1),this.showPlayBtn=!1},forcePlay(){const e=this.$refs.remoteVideo;e&&(e.muted=!1,e.play(),this.showPlayBtn=!1)},scrollToBottom(){this.$nextTick(()=>{const e=this.$refs.chatBox;e&&(e.scrollTop=e.scrollHeight)})}}},q=s(1241);const F=(0,q.A)(U,[["render",Q],["__scopeId","data-v-675ec430"]]);var D=F;(0,i.Ef)(D).mount("#app")},9838:function(){}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,i,a,n){if(!i){var o=1/0;for(d=0;d<e.length;d++){i=e[d][0],a=e[d][1],n=e[d][2];for(var r=!0,c=0;c<i.length;c++)(!1&n||o>=n)&&Object.keys(s.O).every(function(e){return s.O[e](i[c])})?i.splice(c--,1):(r=!1,n<o&&(o=n));if(r){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[i,a,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,i){var a,n,o=i[0],r=i[1],c=i[2],l=0;if(o.some(function(t){return 0!==e[t]})){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);if(c)var d=c(s)}for(t&&t(i);l<o.length;l++)n=o[l],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},i=self["webpackChunkipv6_chat"]=self["webpackChunkipv6_chat"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=s.O(void 0,[504],function(){return s(5788)});i=s.O(i)})();
//# sourceMappingURL=app.b56c3e5e.js.map